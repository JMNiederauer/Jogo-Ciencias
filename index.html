<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pip-Pedro ‚Äî Trilha de Estudos (C√©lulas e Tecidos)</title>
<style>
  :root{
    --bg:#0a0f0a; --scan:#0f200f; --fg:#7CFFA5; --accent:#D5FFDF; --muted:#5dd98b;
    --panel:#0a140a; --border:#1c4a24; --screw:#223e28;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(ellipse at center,var(--scan) 0%,#061006 70%) fixed;color:var(--fg);font-family:"Courier New",monospace}
  /* Visor */
  .pipwatch{position:relative;padding:12px;background:linear-gradient(180deg,#0c160c,#061006 60%);border-bottom:1px solid var(--border);overflow:hidden}
  .pipwatch-inner{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
  .watch-bezel{width:160px;height:160px;min-width:160px;border-radius:20px;background:radial-gradient(circle at 50% 48%, #0d1a0f 0%, #0b160c 60%, #081208 100%);border:2px solid #15321d; position:relative; box-shadow:inset 0 0 22px #0007, 0 0 18px #0006}
  .watch-screen{position:absolute; inset:10px; border-radius:12px; background:#071107; border:1px solid #11311b; overflow:hidden}
  .scanlines::before{content:""; position:absolute; inset:0; background:repeating-linear-gradient(0deg, rgba(124,255,165,0.06), rgba(124,255,165,0.06) 1px, transparent 2px, transparent 5px); mix-blend-mode:screen; pointer-events:none; animation:scan 6s linear infinite}
  @keyframes scan{0%{transform:translateY(-10%)}50%{transform:translateY(10%)}100%{transform:translateY(-10%)}} 
  .watch-ui{position:absolute; inset:0; display:grid; grid-template-rows:1fr auto; padding:6px}
  .watch-hhmm{font-size:36px; letter-spacing:1px; text-align:center; margin-top:24px}
  .watch-date,.watch-sec{font-size:11px;color:var(--muted);text-align:center}
  .watch-bottom{display:flex; justify-content:space-between; align-items:center; font-size:11px; color:var(--muted);padding:0 6px 6px}
  .battery{width:60px;height:8px;border:1px solid var(--border);border-radius:4px; position:relative}
  .battery::after{content:""; position:absolute; right:-5px; top:1px; width:4px; height:6px; background:#11311b; border:1px solid var(--border); border-left:none; border-radius:0 2px 2px 0}
  .battery .fill{height:100%; width:70%; background:linear-gradient(90deg,#26ff8a,#6bffb0)}
  .screw{position:absolute;width:14px;height:14px;border-radius:50%;background:var(--screw);border:1px solid #152b1b;box-shadow:inset 0 0 4px #0008}
  .screw::after{content:""; position:absolute; left:3px; right:3px; top:6px; height:2px; background:#0a1a10}
  .s1{left:6px; top:6px} .s2{right:6px; top:6px} .s3{left:6px; bottom:6px} .s4{right:6px; bottom:6px}
  .titlebar h1{font-size:18px;margin:0;letter-spacing:1px}
  .titlebar .sub{font-size:12px;color:var(--muted)}
  .top-actions{margin-left:auto;display:flex;gap:8px}
  button{background:transparent;border:1px solid var(--border);color:var(--fg);padding:10px 12px;border-radius:10px;cursor:pointer;width:100%}
  button:hover{background:rgba(124,255,165,.12)}
  button[disabled]{opacity:.5;cursor:not-allowed}
  /* Layout principal */
  #wrap{max-width:980px;margin:12px auto;padding:10px;display:grid;grid-template-columns:1fr;gap:10px}
  .panel{border:1px solid var(--border);border-radius:12px;padding:12px;background:rgba(7,17,7,.5);box-shadow:inset 0 0 10px rgba(0,0,0,.5)}
  .title{font-weight:bold;margin-bottom:8px;text-transform:uppercase;font-size:12px;color:var(--accent)}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:8px}
  .cols2{grid-template-columns:1fr 1fr}
  .log{max-height:220px;overflow:auto;border:1px dashed var(--border);padding:8px;border-radius:8px;background:rgba(0,0,0,.2);font-size:12px}
  /* Mapa */
  #mapWrap{border:1px dashed var(--border);border-radius:10px;padding:10px;background:rgba(0,0,0,.2)}
  #map{display:flex;align-items:center;gap:8px;overflow:auto;padding-bottom:6px}
  .node{display:grid;justify-items:center;gap:6px;min-width:88px}
  .dot{width:26px;height:26px;border-radius:50%;border:2px solid var(--border);background:#0b150b;display:grid;place-items:center}
  .dot span{width:14px;height:14px;border-radius:50%;background:#184e2a}
  .node.done .dot span{background:#17d96a;box-shadow:0 0 10px #17d96a88}
  .node.curr .dot{border-color:#7cffb0}
  .node.curr .dot span{background:#7cffb0}
  .node label{font-size:11px;text-align:center}
  .arrow{width:40px;min-width:40px;height:2px;background:linear-gradient(90deg,#214a2a,#357d47);position:relative}
  .arrow::after{content:""; position:absolute; right:-2px; top:-4px; border:6px solid transparent; border-left-color:#357d47}
  /* Modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:99}
  .card{width:min(720px,92vw);background:#081108;border:1px solid var(--border);border-radius:12px;padding:14px}
  .small{font-size:12px}
  .summary{border:1px dashed var(--border);padding:10px;border-radius:10px;background:rgba(0,0,0,.15);font-size:13px;line-height:1.35}
  .choice{width:100%;text-align:left}
  @media (min-width:640px){#wrap{grid-template-columns:320px 1fr}}
</style>
</head>
<body>
  <!-- VISOR -->
  <div class="pipwatch">
    <div class="pipwatch-inner">
      <div class="watch-bezel">
        <div class="screw s1"></div><div class="screw s2"></div><div class="screw s3"></div><div class="screw s4"></div>
        <div class="watch-screen scanlines">
          <div class="watch-ui">
            <div>
              <div id="watch-hhmm" class="watch-hhmm">--:--</div>
              <div id="watch-date" class="watch-date">---</div>
              <div id="watch-sec" class="watch-sec">-- s</div>
            </div>
            <div class="watch-bottom">
              <div>MODE: ESTUDO</div>
              <div class="battery"><div id="batFill" class="fill"></div></div>
              <div>Trilha</div>
            </div>
          </div>
        </div>
      </div>
      <div class="titlebar">
        <div>
          <h1>üìü Pip-Pedro ‚Äî C√©lulas & Tecidos</h1>
          <div class="sub">Baseado no material da professora ‚Äî estudo guiado + quiz</div>
        </div>
      </div>
      <div class="top-actions">
        <button id="btnReset">Zerar progresso</button>
      </div>
    </div>
  </div>

  <div id="wrap">
    <!-- Painel esquerdo -->
    <section class="panel">
      <div class="title">Objetivo</div>
      <div id="objective" class="small"></div>

      <div class="title" style="margin-top:12px">Mapa da Trilha</div>
      <div id="mapWrap">
        <div id="map">
          <div class="node" id="n-org"><div class="dot"><span></span></div><label>Organiza√ß√£o</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-tipos"><div class="dot"><span></span></div><label>Tipos de C√©lula</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-memb"><div class="dot"><span></span></div><label>Membrana</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-organelas"><div class="dot"><span></span></div><label>Organelas</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-tec"><div class="dot"><span></span></div><label>Tecidos</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-pele"><div class="dot"><span></span></div><label>Pele/Epit√©lio</label></div>
          <div class="arrow"></div>
          <div class="node" id="n-micro"><div class="dot"><span></span></div><label>Microscopia</label></div>
        </div>
      </div>

      <div class="title" style="margin-top:12px">Registro</div>
      <div id="log" class="log"></div>
    </section>

    <!-- Painel direito -->
    <section class="panel">
      <div class="title">Local</div>
      <div id="locName"><b>Abrigo ‚Äî In√≠cio</b></div>
      <div class="muted small" id="locDesc">Estude cada √°rea e fa√ßa 2 de 3 no quiz para avan√ßar.</div>

      <div class="title" style="margin-top:10px">A√ß√µes</div>
      <div id="choices" class="grid"></div>
    </section>
  </div>

  <!-- Modal de conte√∫do/quiz -->
  <div class="modal" id="quizModal" role="dialog" aria-modal="true">
    <div class="card">
      <div id="modalTitle" class="title"></div>
      <div id="sectionSummary" class="summary" style="display:none"></div>
      <div id="qContext" class="small muted" style="margin-top:6px"></div>
      <div id="qText" style="margin:6px 0 8px"></div>
      <div id="qAns" class="grid cols2"></div>
      <div id="qFeedback" class="small" style="margin-top:8px"></div>
      <div class="small muted" id="qCounter"></div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button id="qClose">Fechar</button>
      </div>
    </div>
  </div>

<script>
/* ===== SFX simples ===== */
function clickSfx(){ try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type='square'; o.frequency.value=800; g.gain.value=.08; o.connect(g).connect(ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.06); o.stop(ctx.currentTime + 0.06);}catch{} }

/* ===== CONTE√öDO (fiel ao material) ===== */
const SUMMARIES = {
  org: `‚Ä¢ Todo ser vivo √© formado por c√©lula. Em organismos, organelas dentro da membrana formam uma <b>c√©lula</b> ‚Üí c√©lulas com mesma fun√ß√£o formam <b>tecidos</b> ‚Üí diferentes tecidos formam <b>√≥rg√£os</b> ‚Üí √≥rg√£os integrados formam <b>sistemas</b> ‚Üí o conjunto de sistemas comp√µe o <b>organismo</b>.`,
  tipos: `‚Ä¢ <b>Procariontes</b> (bact√©rias e arqueias): t√™m membrana plasm√°tica, parede celular e ribossomos, <b>n√£o</b> t√™m n√∫cleo nem organelas membranosas; DNA disperso no citoplasma. <br>‚Ä¢ <b>Eucariontes</b>: animais (sem parede celular) e vegetais (com parede).`,
  memb: `‚Ä¢ <b>Membrana plasm√°tica</b> contorna a c√©lula e controla a <b>entrada e sa√≠da</b> de subst√¢ncias.`,
  organelas: `‚Ä¢ <b>N√∫cleo</b>: abriga DNA e controla a c√©lula. <br>‚Ä¢ <b>RER</b> (com ribossomos): s√≠ntese de prote√≠nas. <br>‚Ä¢ <b>REL</b>: produ√ß√£o/transforma√ß√£o de lip√≠dios. <br>‚Ä¢ <b>Complexo golgiense</b>: empacota/secretas prote√≠nas. <br>‚Ä¢ <b>Lisossomos</b>: digest√£o intracelular. <br>‚Ä¢ <b>Mitoc√¥ndrias</b>: energia (ATP). <br>‚Ä¢ <b>Centr√≠olos</b>: forma√ß√£o de c√≠lios/flagelos. <br>‚Ä¢ Vegetais: <b>cloroplastos</b> (fotoss√≠ntese), <b>vac√∫olos</b> (armazenamento, √°gua), <b>parede celular</b> (prote√ß√£o).`,
  tec: `‚Ä¢ <b>Tecidos</b> s√£o conjuntos celulares com fun√ß√£o. Em animais, quatro grupos: <b>epitelial</b>, <b>conjuntivo</b>, <b>muscular</b>, <b>nervoso</b>. Conjuntivo: conex√£o, sustenta√ß√£o, defesa, preenchimento, <b>transporte (sangue)</b> e reserva; √© vascularizado (exceto cartilagem) e tem <b>matriz extracelular</b>.`,
  pele: `‚Ä¢ <b>Pele</b>: <b>epiderme</b> (barreira; melan√≥citos ‚Üí melanina, prote√ß√£o UV) ‚Üí <b>derme</b> (resist√™ncia/elasticidade; fol√≠culos, gl√¢ndulas, vasos, nervos no col√°geno) ‚Üí <b>hipoderme</b> (gordura; calor e absor√ß√£o de choque). <b>Epit√©lio</b>: revestimento e prote√ß√£o.`,
  micro: `‚Ä¢ <b>Robert Hooke</b> (microsc√≥pio composto) observou corti√ßa e descreveu ‚Äúc√©lulas‚Äù (compartimentos). <br>‚Ä¢ Microsc√≥pios modernos: <b>√≥ptico</b> e <b>eletr√¥nico</b>.`
};

const QUESTIONS = {
  org: [
    {context:"Organiza√ß√£o biol√≥gica.", q:"Unidade b√°sica da vida:", a:["tecido","√≥rg√£o","c√©lula","organismo"], ok:2},
    {context:"Estruturas maiores.", q:"C√©lulas com fun√ß√µes semelhantes formam:", a:["√≥rg√£o","tecido","sistema","biosfera"], ok:1},
    {context:"Sequ√™ncia correta.", q:"C√©lula ‚Üí tecido ‚Üí √≥rg√£o ‚Üí sistema ‚Üí ‚Ä¶", a:["√°tomo","organismo","mol√©cula","biosfera"], ok:1}
  ],
  tipos: [
    {context:"Procariontes.", q:"Destacam-se pela:", a:["aus√™ncia de membrana plasm√°tica","aus√™ncia de citoplasma","aus√™ncia de n√∫cleo delimitado","aus√™ncia de material gen√©tico"], ok:2},
    {context:"Animal x Vegetal.", q:"C√©lula vegetal possui:", a:["lisossomos","mitoc√¥ndrias","cloroplastos e parede celular","ribossomos"], ok:2},
    {context:"Componentes.", q:"Ribossomos e parede celular:", a:["guardam DNA; produzem energia","fazem prote√≠nas; prote√ß√£o r√≠gida externa","fazem ATP; impedem toda troca","s√≥ existem em animais"], ok:1}
  ],
  /* ===== CORRIGIDO: Membrana com 3 perguntas ===== */
  memb: [
    {context:"Fronteira celular.", q:"A membrana plasm√°tica:", 
     a:["contorna e controla trocas","guarda todo o DNA","gera ATP","s√≥ existe em animais"], ok:0},
    {context:"Fun√ß√£o.", q:"Qual alternativa N√ÉO descreve a membrana plasm√°tica?", 
     a:["controla entrada e sa√≠da de subst√¢ncias","delimita a c√©lula","armazena DNA","mant√©m o meio interno"], ok:2},
    {context:"Onde existe.", q:"A membrana plasm√°tica est√° presente em:", 
     a:["apenas c√©lulas animais","apenas c√©lulas vegetais","animais e vegetais (todas as c√©lulas)","apenas bact√©rias"], ok:2}
  ],
  organelas: [
    {context:"Comando.", q:"Fun√ß√£o do n√∫cleo:", a:["ATP","armazenar DNA e controlar","fotoss√≠ntese","digest√£o"], ok:1},
    {context:"RE.", q:"RER/REL:", a:["prote√≠nas / lip√≠dios","fotoss√≠ntese / divis√£o","excre√ß√£o / respira√ß√£o","osmose / difus√£o"], ok:0},
    {context:"Golgiense.", q:"Complexo de Golgi:", a:["secreta/embala prote√≠nas","quebra mol√©culas","produz ATP","armazena √°gua"], ok:0},
    {context:"Reciclagem.", q:"Lisossomos:", a:["digest√£o intracelular","s√≠ntese de lip√≠dios","fotoss√≠ntese","transporte ativo"], ok:0},
    {context:"Energia.", q:"Mitoc√¥ndrias:", a:["gerar energia","armazenar √°gua","proteger contra UV","formar parede celular"], ok:0},
    {context:"Movimento.", q:"Centr√≠olos:", a:["c√≠lios e flagelos","produ√ß√£o de glicose","armazenamento de lip√≠dios","digest√£o"], ok:0},
    {context:"Verde.", q:"Cloroplastos:", a:["respira√ß√£o","fotoss√≠ntese","excre√ß√£o","digest√£o"], ok:1},
    {context:"Reservas.", q:"Vac√∫olos (vegetais):", a:["contra√ß√£o","armazenamento (√°gua)","produ√ß√£o de prote√≠nas","excre√ß√£o"], ok:1},
    {context:"Parede.", q:"Parede celular:", a:["protege o conte√∫do","faz ATP","impede toda troca","n√£o existe em vegetais"], ok:0},
    {context:"Membranas.", q:"Membrana plasm√°tica e carioteca:", a:["delimitam c√©lula e n√∫cleo","fazem prote√≠nas","armazenam √°gua","produzem energia"], ok:0}
  ],
  tec: [
    {context:"Defini√ß√£o.", q:"Tecidos s√£o:", a:["conjuntos de c√©lulas com fun√ß√£o","apenas √≥rg√£os","apenas sistemas","apenas mol√©culas"], ok:0},
    {context:"Grupos.", q:"Grupos de tecidos animais:", a:["epitelial, conjuntivo, muscular, nervoso","epid√©rmico, √≥sseo, adiposo, nervoso","xilema, floema, col√™nquima, par√™nquima","meristemas, par√™nquimas, col√™nquimas"], ok:0},
    {context:"Fun√ß√µes.", q:"Conjuntivo ‚Äî inclui:", a:["conex√£o, sustenta√ß√£o, defesa, preenchimento, transporte, reserva","apenas impulsos","apenas contra√ß√£o volunt√°ria","fotoss√≠ntese"], ok:0},
    {context:"Vasos.", q:"No conjuntivo (exceto cartilagem):", a:["√© avascular","√© vascularizado","n√£o possui matriz","√© s√≥ epiderme"], ok:1},
    {context:"Matriz.", q:"Matriz extracelular √©:", a:["subst√¢ncias entre as c√©lulas","apenas DNA","apenas √°gua","apenas lip√≠dios"], ok:0},
    {context:"Transporte.", q:"Componente do transporte:", a:["sangue","epiderme","neur√¥nio","m√∫sculo estriado"], ok:0}
  ],
  pele: [
    {context:"Camadas.", q:"Ordem da pele (fora‚Üídentro):", a:["derme‚Üíepiderme‚Üíhipoderme","epiderme‚Üíderme‚Üíhipoderme","hipoderme‚Üíderme‚Üíepiderme","derme‚Üíhipoderme‚Üíepiderme"], ok:1},
    {context:"Fun√ß√£o.", q:"Epit√©lio/pele atua em:", a:["revestimento e prote√ß√£o","fotoss√≠ntese","armazenar c√°lcio","apenas condu√ß√£o"], ok:0},
    {context:"Melanina.", q:"Melan√≥citos na epiderme:", a:["produzem melanina (prote√ß√£o UV)","contra√ß√£o volunt√°ria","conduzem impulsos","armazenam √°gua"], ok:0},
    {context:"Derme.", q:"Derme ‚Äî caracter√≠sticas:", a:["resist√™ncia/elasticidade; fol√≠culos, gl√¢ndulas, vasos e nervos no col√°geno","camada externa contra desidrata√ß√£o","camada de gordura","tecido nervoso"], ok:0},
    {context:"Hipoderme.", q:"Hipoderme:", a:["√∫ltima camada; calor e absor√ß√£o de choque","barreira externa","camada r√≠gida com c√°lcio","tecido nervoso"], ok:0}
  ],
  micro: [
    {context:"Hist√≥ria.", q:"Hooke observou corti√ßa com:", a:["microsc√≥pio composto","telesc√≥pio","raios X","lupa"], ok:0},
    {context:"Hoje.", q:"Microsc√≥pios modernos:", a:["√≥ptico e eletr√¥nico","infravermelho e gama","apenas √≥ptico","apenas eletr√¥nico"], ok:0},
    {context:"Corti√ßa.", q:"Na corti√ßa, Hooke viu principalmente:", a:["compartimentos/‚Äòc√©lulas‚Äô vazias","DNA","cloroplastos vivos","mitoc√¥ndrias"], ok:0}
  ]
};

/* ===== TRILHA ===== */
const SECTIONS = [
  {key:'org', label:'Organiza√ß√£o dos seres vivos'},
  {key:'tipos', label:'Tipos de c√©lula'},
  {key:'memb', label:'Membrana plasm√°tica'},
  {key:'organelas', label:'Organelas'},
  {key:'tec', label:'Tecidos (vis√£o geral)'},
  {key:'pele', label:'Pele & Epit√©lio'},
  {key:'micro', label:'Microscopia'}
];

const state = { passed:{org:false,tipos:false,memb:false,organelas:false,tec:false,pele:false,micro:false}, loc:'start' };

/* ===== UI refs ===== */
const objective=document.getElementById('objective');
const locName=document.getElementById('locName');
const locDesc=document.getElementById('locDesc');
const choices=document.getElementById('choices');
const logEl=document.getElementById('log');
const btnReset=document.getElementById('btnReset');

/* ===== Helpers ===== */
function log(t){ logEl.innerHTML += `‚Ä¢ ${t}<br>`; logEl.scrollTop = logEl.scrollHeight; }
function currentStep(){ for(let i=0;i<SECTIONS.length;i++){ if(!state.passed[SECTIONS[i].key]) return i; } return SECTIONS.length; }
function renderObjective(){ const i=currentStep(); objective.textContent = i<SECTIONS.length ? `Estude a se√ß√£o: ${SECTIONS[i].label} e acerte 2/3 no quiz.` : "Trilha conclu√≠da. Clique em ‚ÄúConcluir estudo‚Äù."; }
function save(){ try{ localStorage.setItem("pipPedroStudyV1", JSON.stringify(state)); }catch{} }
function load(){ try{ const s=JSON.parse(localStorage.getItem("pipPedroStudyV1")||"null"); if(s) Object.assign(state,s); }catch{} }

/* ===== Mapa ===== */
function renderMap(){
  const domIds = ['n-org','n-tipos','n-memb','n-organelas','n-tec','n-pele','n-micro'];
  domIds.forEach((id,i)=>{
    const el=document.getElementById(id);
    el.className='node';
    if(state.passed[SECTIONS[i].key]) el.classList.add('done');
    if(i===currentStep()) el.classList.add('curr');
  });
}

/* ===== Navega√ß√£o ===== */
function gotoStart(){
  state.loc='start'; save();
  locName.innerHTML='<b>Abrigo ‚Äî In√≠cio</b>';
  locDesc.textContent='Estude cada √°rea e depois fa√ßa o quiz (2/3).';
  choices.innerHTML='';
  const i=currentStep();
  if(i<SECTIONS.length){
    addChoice(`Estudar: ${SECTIONS[i].label}`, ()=>openSummary(SECTIONS[i].key));
    addChoice(`Quiz (2 de 3): ${SECTIONS[i].label}`, ()=>startQuiz(SECTIONS[i].key));
  } else {
    addChoice('Concluir estudo', ()=>{ log('<b>Parab√©ns! Trilha conclu√≠da.</b>'); });
  }
  renderObjective(); renderMap();
}
function addChoice(label,fn){ const b=document.createElement('button'); b.className='choice'; b.textContent=label; b.onclick=()=>{ clickSfx(); fn(); }; choices.appendChild(b); }

/* ===== Modal refs ===== */
const quizModal=document.getElementById('quizModal');
const modalTitle=document.getElementById('modalTitle');
const sectionSummary=document.getElementById('sectionSummary');
const qContext=document.getElementById('qContext');
const qText=document.getElementById('qText');
const qAns=document.getElementById('qAns');
const qFeedback=document.getElementById('qFeedback');
const qCounter=document.getElementById('qCounter');
document.getElementById('qClose').onclick=()=>{ quizModal.style.display='none'; };

/* ===== Estudo (resumo) ===== */
function openSummary(key){
  modalTitle.textContent = 'Resumo ‚Äî ' + sectionLabel(key);
  sectionSummary.style.display='block';
  sectionSummary.innerHTML = SUMMARIES[key];
  qContext.textContent=''; qText.textContent=''; qAns.innerHTML=''; qFeedback.textContent=''; qCounter.textContent='';
  quizModal.style.display='flex';
}

/* ===== Quiz (CORRIGIDO: alvo din√¢mico + compara√ß√£o num√©rica) ===== */
function startQuiz(key){
  const pool = QUESTIONS[key].slice();
  shuffle(pool);

  const picks = pool.slice(0, Math.min(3, pool.length)); // at√© 3
  const target = Math.min(2, picks.length);              // precisa de 2, mas se s√≥ tiver 1, precisa de 1
  let idx = 0, correct = 0;

  modalTitle.textContent = 'Quiz ‚Äî ' + sectionLabel(key);
  sectionSummary.style.display='none';

  function updateCounter(){
    qCounter.textContent = `Acertos: ${correct} / ${idx}  (precisa de ${target})`;
  }

  function ask(){
    if (correct >= target) return finish();
    if (idx >= picks.length){
      if (correct >= target) return finish();
      qFeedback.innerHTML = `<span class='muted'>Voc√™ fez ${correct}/${picks.length}. Tente novamente.</span>`;
      setTimeout(()=>{ quizModal.style.display='none'; }, 700);
      return;
    }
    const item = picks[idx];
    qContext.textContent = item.context;
    qText.textContent = 'Pergunta: ' + item.q;
    qAns.innerHTML = ''; qFeedback.textContent = ''; updateCounter();

    item.a.forEach((opt, i)=>{
      const b = document.createElement('button'); 
      b.textContent = opt;
      b.onclick = ()=>{
        clickSfx();
        if (Number(i) === Number(item.ok)){
          correct++;
          qFeedback.innerHTML = "<b>‚úî Correto!</b>";
        } else {
          qFeedback.innerHTML = "<b>‚úñ Resposta incorreta.</b>";
        }
        idx++; 
        setTimeout(ask, 350);
      };
      qAns.appendChild(b);
    });
  }

  function finish(){
    state.passed[key] = true; 
    save();
    log(`Se√ß√£o conclu√≠da: <b>${sectionLabel(key)}</b>.`);
    quizModal.style.display='none';
    gotoStart();
  }

  quizModal.style.display='flex';
  ask();
}

/* ===== utils ===== */
function sectionLabel(k){ return (SECTIONS.find(s=>s.key===k)||{}).label||''; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

/* ===== Rel√≥gio ===== */
function pad(n){return (n<10?'0':'')+n;}
function updateWatch(){
  const now = new Date();
  const hh = pad(now.getHours()), mm = pad(now.getMinutes()), ss = pad(now.getSeconds());
  const days = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  const months = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  document.getElementById('watch-hhmm').textContent = `${hh}:${mm}`;
  document.getElementById('watch-sec').textContent = `${ss} s`;
  document.getElementById('watch-date').textContent = `${days[now.getDay()]} ‚Ä¢ ${pad(now.getDate())} ${months[now.getMonth()]} ${now.getFullYear()}`;
  const bat = 50 + 40*Math.sin(now.getMinutes()/60*Math.PI*2);
  document.getElementById('batFill').style.width = `${Math.max(8,Math.min(98,bat))}%`;
}
setInterval(updateWatch, 1000); updateWatch();

/* ===== Inicializa√ß√£o ===== */
btnReset.onclick = ()=>{ if(confirm("Apagar progresso salvo?")){ localStorage.removeItem("pipPedroStudyV1"); location.reload(); } };
load(); gotoStart(); renderMap();
log("Bem-vindo, Pedro. Estude cada √°rea e fa√ßa os quizzes.");
</script>
</body>
</html>
